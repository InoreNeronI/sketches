{"mappings":"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","sources":["src/supratetris/js/Grid.js"],"sourcesContent":["class Grid {\n  constructor(w, h, cellSize) {\n    this.w = w;\n    this.h = h;\n    this.cellSize = cellSize;\n\n    this.grid = [];\n\n    this.targetColour = -1;\n  }\n\n  createGrid() {\n    for (let i = 0; i < this.w; i++) {\n      let col = [];\n\n      for (let j = 0; j < this.h; j++) {\n        col.push(new Cell(i, j, this.cellSize));\n      }\n\n      this.grid.push(col);\n    }\n\n    let lastRow = [];\n\n    for (let i = 0; i < this.w; i++) {\n      if (i > this.w * 0.55) lastRow.push(true);\n      else lastRow.push(false);\n    }\n\n    shuffle(lastRow, true);\n\n    for (let i = 0; i < this.w; i++) {\n      this.grid[i][this.h - 1].dead = lastRow[i];\n    }\n  }\n\n  update() {}\n\n  validate() {\n    let numberSelected = 0;\n\n    for (let i = 0; i < this.w; i++) {\n      for (let j = 0; j < this.h; j++) {\n        if (this.grid[i][j].selected) numberSelected++;\n      }\n    }\n\n    if (numberSelected != 4) return false;\n\n    for (let i = 0; i < targets.length; i++) {\n      if (this.gridContains(targets[i].shape)) {\n        this.targetColour = targets[i].colour;\n        targets[i].newShape();\n        return true;\n      }\n    }\n\n    playSoundFromArray('incompleteShape');\n    return false;\n  }\n\n  gridContains(shape) {\n    let firstGridCell = -1;\n\n    dance: for (let j = 0; j < this.h; j++) {\n      for (let i = 0; i < this.w; i++) {\n        if (this.grid[i][j].selected) {\n          firstGridCell = [i, j];\n          break dance;\n        }\n      }\n    }\n\n    let firstTargetCell = -1;\n    let targetShapeCount = 0;\n\n    for (let i = 0; i < shape[0].length; i++) {\n      for (let j = 0; j < shape.length; j++) {\n        if (shape[i][j]) {\n          targetShapeCount++;\n\n          if (firstTargetCell == -1) {\n            firstTargetCell = [j, i];\n          } else {\n            if (firstGridCell[0] + j - firstTargetCell[0] >= this.w || firstGridCell[0] + j - firstTargetCell[0] < 0) return false;\n            let cell = this.grid[firstGridCell[0] + j - firstTargetCell[0]][firstGridCell[1] + i - firstTargetCell[1]];\n\n            if (cell instanceof Cell && !cell.selected) {\n              return false;\n            }\n          }\n\n          let potentialX = firstGridCell[0] + j - firstTargetCell[0];\n          let potentialY = firstGridCell[1] + i - firstTargetCell[1];\n\n          let cellBelow = this.grid[potentialX][potentialY + 1];\n\n          if (cellBelow instanceof Cell && !cellBelow.selected && !cellBelow.dead) {\n            return false;\n          }\n\n          if (targetShapeCount == 4) return true;\n        }\n      }\n    }\n  }\n\n  dropSelected() {\n    for (let i = 0; i < this.w; i++) {\n      for (let j = 0; j < this.h; j++) {\n        if (this.grid[i][j].selected) {\n          this.grid[i][j].selected = false;\n          this.grid[i][j].dead = true;\n          fallingCells.push(new FallingCell(this.grid[i][j].xPos, this.grid[i][j].yPos, this.cellSize, this.targetColour));\n        }\n      }\n    }\n  }\n\n  addNewRow() {\n    for (let i = 0; i < this.w; i++) {\n      for (let j = 0; j < this.h; j++) {\n        if (this.grid[i][j].dead) {\n          if (random() < 0.5) this.grid[i][j].dead = false;\n          break;\n        }\n      }\n    }\n  }\n\n  hover() {\n    let numberSelected = 0;\n\n    for (let i = 0; i < this.w; i++) {\n      for (let j = 0; j < this.h; j++) {\n        if (this.grid[i][j].selected) numberSelected++;\n      }\n    }\n\n    for (let i = 0; i < this.w; i++) {\n      for (let j = 0; j < this.h; j++) {\n        if (this.grid[i][j].hover()) {\n          if (numberSelected >= 4 && !this.grid[i][j].selected) {\n            return false;\n          } else {\n            this.grid[i][j].selected = !this.grid[i][j].selected;\n            if (this.grid[i][j].selected && numberSelected <= 2) sounds.selectBlock[numberSelected].play();\n            if (!this.grid[i][j].selected) playSoundFromArray('deselectBlock');\n\n            if (!interacted) {\n              interacted = true;\n              sounds.music.play();\n            }\n\n            return true;\n          }\n        }\n      }\n    }\n  }\n\n  clearSelected() {\n    for (let i = 0; i < this.w; i++) {\n      for (let j = 0; j < this.h; j++) {\n        if (this.grid[i][j].selected) this.grid[i][j].selected = false;\n      }\n    }\n  }\n\n  updateScore() {\n    let actualScore = 0;\n\n    for (let i = 0; i < this.w; i++) {\n      for (let j = 0; j < this.h; j++) {\n        if (!this.grid[i][j].dead) actualScore++;\n      }\n    }\n\n    if (score == -1 || actualScore < score) {\n      score = actualScore;\n    }\n  }\n\n  display() {\n    push();\n    translate(width / 2, height / 2);\n    translate((-this.cellSize * this.w) / 2, (-this.cellSize * this.h) / 2);\n\n    fill(palette.blacker);\n    strokeWeight(5);\n    stroke(palette.blackest);\n    rectMode(CORNER);\n    rect(-this.cellSize / 2, -this.cellSize / 2, this.w * this.cellSize + this.cellSize, height, 40);\n    rectMode(CENTER);\n    strokeWeight(1);\n\n    translate(this.cellSize / 2, this.cellSize / 2);\n\n    for (let i = 0; i < this.w; i++) {\n      for (let j = 0; j < this.h; j++) {\n        this.grid[i][j].display();\n      }\n    }\n\n    pop();\n  }\n}\n"],"names":[],"version":3,"file":"index.6703a2cc.js.map"}