{"mappings":"","sources":["src/flappy-bird/index.js"],"sourcesContent":["/*\n * Made by Stephcraft\n * website: https://stephcraft.net\n * game available at: https://stephcraft.itch.io/flappy-bird\n */\n\nvar c;\n\nvar sprite_flappy;\nvar sprite_pipe;\nvar sprite_city;\nvar sprite_floor;\nvar sprite_title;\n\nvar sound_point;\nvar sound_wing;\nvar sound_hit;\nvar sound_die;\nvar sound_sweetwing;\n\nvar font_flappy;\n\n//EVENTS\nvar mousePress = false;\nvar mousePressEvent = false;\nvar mouseReleaseEvent = false;\nvar keyPress = false;\nvar keyPressEvent = false;\nvar keyReleaseEvent = false;\n\nvar pipes = [];\n\nvar score = 0;\nvar hightscore = 0;\nvar speed = 3;\nvar gap = 80;\n\nvar gameover = false;\nvar page = 'MENU';\n\nvar overflowX = 0;\n\nvar flappy_bird = {\n  x: 100,\n  y: 0,\n\n  target: 0,\n\n  velocityY: 0,\n\n  fly: false,\n\n  angle: 0,\n\n  falls: false,\n  flashAnim: 0,\n  flashReturn: false,\n  kinematicAnim: 0,\n\n  display: function () {\n    if (!mousePress || this.falls) {\n      push();\n      translate(this.x, this.y);\n      rotate(radians(this.angle));\n      image(\n        sprite_flappy,\n        0,\n        0,\n        sprite_flappy.width * 1.5,\n        sprite_flappy.height * 3,\n        0,\n        0,\n        sprite_flappy.width / 2,\n        sprite_flappy.height * 3,\n      );\n      pop();\n    } else {\n      push();\n      translate(this.x, this.y);\n      rotate(radians(this.angle));\n      image(\n        sprite_flappy,\n        0,\n        0,\n        sprite_flappy.width * 1.5,\n        sprite_flappy.height * 3,\n        sprite_flappy.width / 2,\n        0,\n        sprite_flappy.width / 2,\n        sprite_flappy.height * 3,\n      );\n      pop();\n    }\n  },\n\n  update: function () {\n    if (this.falls) {\n      if (this.flashAnim > 255) {\n        this.flashReturn = true;\n      }\n\n      if (this.flashReturn) {\n        this.flashAnim -= 60;\n      } else {\n        this.flashAnim += 60;\n      }\n\n      if (this.flashReturn && this.flashAnim === 0) {\n        gameover = true;\n        menu_gameover.easein();\n        try {\n          sound_die.play();\n        } catch (e) {\n          console.log(e);\n        }\n\n        if (score > hightscore) {\n          hightscore = score;\n        }\n      }\n\n      this.y += this.velocityY;\n      this.velocityY += 0.4;\n      this.angle += 4;\n\n      if (speed > 0) {\n        speed = 0;\n      }\n\n      if (this.angle > 90) {\n        this.angle = 90;\n      }\n    } else {\n      this.y += this.velocityY;\n      this.angle += 2.5;\n\n      if (this.angle > 90) {\n        this.angle = 90;\n      }\n\n      if (mousePressEvent || (keyPressEvent && key === ' ')) {\n        try {\n          sound_wing.play();\n        } catch (e) {\n          console.log(e);\n        }\n\n        this.velocityY = 0;\n        this.fly = true;\n        this.target = clamp(this.y - 60, -19, height);\n        this.angle = -45;\n      }\n\n      if (this.y < this.target) {\n        this.fly = false;\n        this.target = 10000;\n      }\n\n      if (!this.fly) {\n        this.velocityY += 0.4;\n      } else {\n        this.y -= 5;\n      }\n\n      if (this.y > height - 49) {\n        if (!flappy_bird.falls) {\n          try {\n            sound_hit.play();\n          } catch (e) {\n            console.log(e);\n          }\n        }\n        this.falls = true;\n      }\n    }\n    this.y = clamp(this.y, -20, height - 50);\n  },\n\n  kinematicMove: function () {\n    if (gameover) {\n      this.x = width / 2;\n      this.y = height / 2;\n\n      gameover = false;\n      score = 0;\n      gap = 90;\n    }\n\n    this.y = height / 2 + map(sin(frameCount * 0.1), 0, 1, -2, 2);\n\n    push();\n    translate(this.x, this.y);\n    image(\n      sprite_flappy,\n      0,\n      0,\n      sprite_flappy.width * 1.5,\n      sprite_flappy.height * 3,\n      0,\n      0,\n      sprite_flappy.width / 2,\n      sprite_flappy.height * 3,\n    );\n    pop();\n  },\n};\n\nfunction setup() {\n  if (mobile()) {\n    c = createCanvas(windowWidth, windowHeight);\n  } else {\n    c = createCanvas(400, 600);\n  }\n  c.parent('FlappyBird');\n\n  imageMode(CENTER);\n  rectMode(CENTER);\n  ellipseMode(CENTER);\n  textAlign(CENTER, CENTER);\n\n  //disableScroll();\n\n  noSmooth();\n\n  pipes[0] = new Pipe();\n\n  //load\n  sprite_flappy = loadImage('../assets/flappy-bird/flappybird.png');\n  sprite_pipe = loadImage('../assets/flappy-bird/pipe.png');\n  sprite_city = loadImage('../assets/flappy-bird/city.png');\n  sprite_floor = loadImage('../assets/flappy-bird/floor.png');\n  sprite_title = loadImage('../assets/flappy-bird/title.png');\n\n  sound_point = loadSound('../assets/flappy-bird/sfx_point.wav');\n  sound_hit = loadSound('../assets/flappy-bird/sfx_hit.wav');\n  sound_die = loadSound('../assets/flappy-bird/sfx_die.wav');\n  sound_wing = loadSound('../assets/flappy-bird/sfx_wing.wav');\n  sound_sweetwing = loadSound('../assets/flappy-bird/sfx_swooshing.wav');\n\n  font_flappy = loadFont('../assets/flappy-bird/flappy-font.ttf');\n\n  flappy_bird.y = height / 2;\n\n  try {\n    textFont(font_flappy);\n  } catch (e) {\n    console.log(e);\n  }\n}\n\nfunction ss(data) {\n  console.log(data);\n}\n\nfunction draw() {\n  background(123, 196, 208);\n\n  switch (page) {\n    case 'GAME':\n      page_game();\n      break;\n    case 'MENU':\n      page_menu();\n      break;\n  }\n\n  //FRAMERATE\n  //fill(0);\n  //text(int(frameRate()),20,35);\n\n  //EVENT\n  mousePressEvent = false;\n  mouseReleaseEvent = false;\n  keyPressEvent = false;\n  keyReleaseEvent = false;\n}\n\n//EVENT\nfunction mousePressed() {\n  mousePress = true;\n  mousePressEvent = true;\n}\nfunction mouseReleased() {\n  mousePress = false;\n  mouseReleaseEvent = true;\n}\nfunction keyPressed() {\n  keyPress = true;\n  keyPressEvent = true;\n}\nfunction keyReleased() {\n  keyPress = false;\n  keyReleaseEvent = true;\n}\n\n//PAGES\nfunction page_game() {\n  overflowX += speed;\n  if (overflowX > sprite_city.width / 2) {\n    overflowX = 0;\n  }\n\n  //City\n  image(\n    sprite_city,\n    sprite_city.width / 2 / 2,\n    height - sprite_city.height / 2 / 2 - 40,\n    sprite_city.width / 2,\n    sprite_city.height / 2,\n  );\n\n  //creator\n  if (!flappy_bird.falls) {\n    if (parseInt(frameCount) % 70 === 0) {\n      pipes.push(new Pipe());\n    }\n  }\n\n  for (var i = 0; i < pipes.length; i++) {\n    if (pipes[i].x < -50) {\n      pipes.splice(i, 1);\n    }\n\n    try {\n      pipes[i].display();\n      pipes[i].update();\n    } catch (e) {\n      console.log(e);\n    }\n  }\n\n  //Floor\n  image(\n    sprite_floor,\n    sprite_floor.width - overflowX,\n    height - sprite_floor.height,\n    sprite_floor.width * 2,\n    sprite_floor.height * 2,\n  );\n  image(\n    sprite_floor,\n    sprite_floor.width + sprite_floor.width - overflowX,\n    height - sprite_floor.height,\n    sprite_floor.width * 2,\n    sprite_floor.height * 2,\n  );\n  image(\n    sprite_floor,\n    sprite_floor.width + sprite_floor.width * 2 - overflowX,\n    height - sprite_floor.height,\n    sprite_floor.width * 2,\n    sprite_floor.height * 2,\n  );\n\n  flappy_bird.display();\n  flappy_bird.update();\n  flappy_bird.x = smoothMove(flappy_bird.x, 90, 0.02);\n\n  //Score\n  if (!gameover) {\n    push();\n    stroke(0);\n    strokeWeight(5);\n    fill(255);\n    textSize(30);\n    text(score, width / 2, 50);\n    pop();\n  }\n\n  push();\n  noStroke();\n  fill(255, flappy_bird.flashAnim);\n  rect(width / 2, height / 2, width, height);\n  pop();\n\n  if (gameover) {\n    menu_gameover.display();\n    menu_gameover.update();\n  }\n}\n\nfunction page_menu() {\n  speed = 1;\n  overflowX += speed;\n  if (overflowX > sprite_city.width / 2) {\n    overflowX = 0;\n  }\n\n  //City\n  image(\n    sprite_city,\n    sprite_city.width / 2 / 2,\n    height - sprite_city.height / 2 / 2 - 40,\n    sprite_city.width / 2,\n    sprite_city.height / 2,\n  );\n\n  //Floor\n  image(\n    sprite_floor,\n    sprite_floor.width - overflowX,\n    height - sprite_floor.height,\n    sprite_floor.width * 2,\n    sprite_floor.height * 2,\n  );\n  image(\n    sprite_floor,\n    sprite_floor.width + sprite_floor.width - overflowX,\n    height - sprite_floor.height,\n    sprite_floor.width * 2,\n    sprite_floor.height * 2,\n  );\n  image(\n    sprite_floor,\n    sprite_floor.width + sprite_floor.width * 2 - overflowX,\n    height - sprite_floor.height,\n    sprite_floor.width * 2,\n    sprite_floor.height * 2,\n  );\n\n  image(sprite_title, width / 2, 100, sprite_title.width / 4, sprite_title.height / 4);\n\n  flappy_bird.kinematicMove();\n\n  push();\n  fill(230, 97, 29);\n  stroke(255);\n  strokeWeight(3);\n  text('Tap to play', width / 2, height / 2 - 50);\n  pop();\n\n  if (mousePressEvent || (keyPressEvent && key == ' ')) {\n    page = 'GAME';\n    resetGame();\n\n    flappy_bird.velocityY = 0;\n    flappy_bird.fly = true;\n    flappy_bird.target = clamp(this.y - 60, -19, height);\n    flappy_bird.angle = -45;\n    flappy_bird.update();\n  }\n  flappy_bird.x = width / 2;\n}\n\nfunction Pipe() {\n  this.gapSize = gap;\n  this.y = random(150, height - 150);\n  this.x = width + 50;\n  this.potential = true;\n\n  this.display = function () {\n    push();\n    translate(this.x, this.y + this.gapSize + sprite_pipe.height / 2 / 2);\n    image(sprite_pipe, 0, 0, sprite_pipe.width / 2, sprite_pipe.height / 2);\n    pop();\n\n    push();\n    translate(this.x, this.y - this.gapSize - sprite_pipe.height / 2 / 2);\n    rotate(radians(180));\n    scale(-1, 1);\n    image(sprite_pipe, 0, 0, sprite_pipe.width / 2, sprite_pipe.height / 2);\n    pop();\n\n    //Score\n    if (this.potential && flappy_bird.x > this.x - 25 && flappy_bird.x < this.x + 25) {\n      score++;\n      try {\n        sound_point.play();\n      } catch (e) {\n        console.log(e);\n      }\n\n      if (gap > 60) {\n        gap--;\n      }\n      //if(speed < 20) { speed+=0.1; }\n\n      this.potential = false;\n    }\n\n    //Pipes collisions\n    if (\n      (flappy_bird.x + 20 > this.x - 25 &&\n        flappy_bird.x - 20 < this.x + 25 &&\n        flappy_bird.y + 20 > this.y - this.gapSize - sprite_pipe.height / 2 / 2 - 200 &&\n        flappy_bird.y - 20 < this.y - this.gapSize - sprite_pipe.height / 2 / 2 + 200) ||\n      (flappy_bird.x + 20 > this.x - 25 &&\n        flappy_bird.x - 20 < this.x + 25 &&\n        flappy_bird.y + 20 > this.y + this.gapSize + sprite_pipe.height / 2 / 2 - 200 &&\n        flappy_bird.y - 20 < this.y + this.gapSize + sprite_pipe.height / 2 / 2 + 200)\n    ) {\n      if (!flappy_bird.falls) {\n        try {\n          sound_hit.play();\n        } catch (e) {\n          console.log(e);\n        }\n      }\n      flappy_bird.falls = true;\n    }\n  };\n  this.update = function () {\n    this.x -= speed;\n  };\n}\n\n//utility\nfunction clamp(value, min, max) {\n  if (value < min) {\n    value = min;\n  }\n  if (value > max) {\n    value = max;\n  }\n\n  return value;\n}\n\nfunction resetGame() {\n  gameover = false;\n  gap = 80;\n  speed = 3;\n  score = 0;\n  flappy_bird.y = height / 2;\n  flappy_bird.falls = false;\n  flappy_bird.velocityY = 0;\n  flappy_bird.angle = 0;\n  flappy_bird.flashAnim = 0;\n  flappy_bird.flashReturn = false;\n  pipes = [];\n  flappy_bird.target = 10000;\n  menu_gameover.ease = 0;\n}\n\n//Menu Gameover\nvar menu_gameover = {\n  ease: 0,\n  easing: false,\n  open: false,\n\n  display: function () {\n    push();\n    translate(width / 2, height / 2);\n    scale(this.ease);\n\n    stroke(83, 56, 71);\n    strokeWeight(2);\n    fill(222, 215, 152);\n    rect(0, 0, 200, 200);\n\n    noStroke();\n    fill(83, 56, 71);\n    text('by Stephcraft', 0, -50);\n\n    //Title\n    textSize(20);\n    strokeWeight(5);\n    stroke(83, 56, 71);\n    fill(255);\n    text('Flappy Bird', 0, -80);\n\n    //Info\n    push();\n    textAlign(LEFT, CENTER);\n    textSize(12);\n    noStroke();\n    fill(83, 56, 71);\n    text('score : ', -80, 0);\n    text('hightscore : ', -80, 30);\n\n    stroke(0);\n    strokeWeight(3);\n    fill(255);\n    text(score, 20, 0);\n    text(hightscore, 20, 30);\n    pop();\n\n    if (press('restart', 0, 140, width / 2, height / 2)) {\n      resetGame();\n    }\n\n    if (press(' menu ', 0, 190, width / 2, height / 2)) {\n      page = 'MENU';\n    }\n    pop();\n  },\n\n  update: function () {\n    if (this.easing) {\n      this.ease += 0.1;\n      if (this.ease > 1) {\n        this.open = true;\n        this.ease = 1;\n        this.easing = false;\n      }\n    }\n  },\n\n  easein: function () {\n    this.easing = true;\n  },\n};\n\nfunction press(txt, x, y, tX, tY) {\n  var this_h = false;\n\n  if (\n    mouseX > tX + x - textWidth(txt) / 2 - 10 &&\n    mouseX < tX + x + textWidth(txt) / 2 + 10 &&\n    mouseY > tY + y - textAscent() / 2 - 10 &&\n    mouseY < tY + y + textAscent() / 2 + 10\n  ) {\n    this_h = true;\n  }\n\n  push();\n  textSize(16);\n\n  if (this_h && mousePress) {\n    noStroke();\n    fill(83, 56, 71);\n    rect(x, y + 3, textWidth(txt) + 25 + 10, textAscent() + 10 + 10);\n\n    fill(250, 117, 49);\n    stroke(255);\n    strokeWeight(3);\n    rect(x, y + 2, textWidth(txt) + 25, textAscent() + 10);\n\n    noStroke();\n    fill(255);\n    text(txt, x, y + 2);\n  } else {\n    noStroke();\n    fill(83, 56, 71);\n    rect(x, y + 2, textWidth(txt) + 25 + 10, textAscent() + 10 + 12);\n\n    if (this_h) {\n      fill(250, 117, 49);\n    } else {\n      fill(230, 97, 29);\n    }\n    stroke(255);\n    strokeWeight(3);\n    rect(x, y, textWidth(txt) + 25, textAscent() + 10);\n\n    noStroke();\n    fill(255);\n    text(txt, x, y);\n  }\n  pop();\n\n  if (this_h && mouseReleaseEvent) {\n    try {\n      sound_sweetwing.play();\n    } catch (e) {\n      console.log(e);\n    }\n  }\n\n  return this_h && mouseReleaseEvent;\n}\n\nfunction smoothMove(pos, target, speed) {\n  return pos + (target - pos) * speed;\n}\n\nfunction mobile() {\n  return !!(\n    navigator.userAgent.match(/Android/i) ||\n    navigator.userAgent.match(/webOS/i) ||\n    navigator.userAgent.match(/iPhone/i) ||\n    navigator.userAgent.match(/iPad/i) ||\n    navigator.userAgent.match(/iPod/i) ||\n    navigator.userAgent.match(/BlackBerry/i) ||\n    navigator.userAgent.match(/Windows Phone/i)\n  );\n}\n"],"names":[],"version":3,"file":"index.a4546404.js.map"}